# Python的垃圾回收机制GC

> Python采用最经典的的引用计数来作为自动内存管理的方案


## 垃圾回收

- 当对象引用计数为0时，它将被垃圾回收机制回收
- 还有些情况对象引用不为0也该被回收时(相互引用)，由解释器定期检查回收


### 引用计数

> Python中每一个对象都会有一个引用计数的值，
> 对象被引用时增加，反之减少，当计数归零时，调用回收函数清理并释放内存

### 分代回收

> 当多个对象互相引用导致循环引用时，导致引用计数的方式无法回收对象
> 所以python还有另外一种垃圾回收机制，分代回收。
> Python对象分为 年轻代(第0代)、中年代(第1代)、老年代(第2代)
> 代数越高代表对象的存活时间越长，当年轻代的存储数量达到上限时，
> 垃圾回收机制将回收需要被回收的，其他移到中年代，依次类推。

## 内存管理

CPython 3.6： 大小对象 以512字节为界， Arena为512 KB， Pool为4KB

> Python中的对象以某个阈值来分为小对象与大对象。
> 大对象直接走正常的内存分配，小对象走专用的内存分配器

`Pool`块
> Python向系统申请一大块`Arena`内存，将Arena按页大小再分成多个`Pool`块
> 每个`Pool`为一种类型的对象提供内存，`Pool`被回收后可被其他类型对象使用

`Block`块
> 按指定类型的对象又将`Pool`分成多个`Block`块，每个`Block`块又可以存储
> 一个相同类型的小对象

这样小对象就可以走python的快速分配，不用再频繁的向系统申请内存。

